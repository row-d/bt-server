<div
  x-data="songSelector"
  class="mt-4 pt-4 border-t border-gray-100"
  x-show="songs.length > 0"
>
  <h3 class="text-sm font-medium mb-2 text-gray-700">Canciones de ejemplo</h3>
  <div class="flex flex-wrap gap-2">
    <template x-for="song in songs" :key="song.name">
      <button
        type="button"
        class="text-xs bg-gray-50 hover:bg-gray-100 text-gray-700 rounded px-2 py-1 border border-gray-200 transition-colors"
        x-text="song.name"
        x-on:click="$dispatch('song-selected', song.sequence)"
        title="Copiar melodÃ­a"
      ></button>
    </template>
  </div>
</div>

<script>
  import Alpine from "alpinejs";

  document.addEventListener("alpine:init", () => {
    Alpine.data("songSelector", () => ({
      songs: [] as { name: string; sequence: string }[],
      init() {
        this.loadSongs();
      },
      async loadSongs() {
        try {
          const response = await fetch("/songs.txt");
          if (!response.ok) return;
          const text = await response.text();
          const blocks = text.split(/\n\s*\n/);
          this.songs = blocks
            .map((block) => {
              const lines = block
                .split("\n")
                .map((l) => l.trim())
                .filter(Boolean);
              if (lines.length >= 2) {
                const name = lines[0].replace(":", "");
                const sequence = lines[1];
                return { name, sequence };
              }
              return null;
            })
            .filter((s): s is { name: string; sequence: string } => s !== null);
        } catch (e) {
          console.error("Error loading songs", e);
        }
      },
    }));
  });
</script>
